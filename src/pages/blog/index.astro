---
import Layout from '../../layouts/BaseLayout.astro';
import SectionDivider from '../../components/SectionDivider.astro';
import { getCollection } from 'astro:content';

const allPosts = await getCollection('blog', ({ data }) => !data.draft);
const posts = allPosts.sort((a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf());

// Count posts per category
const categoryNames = ['Vocal Health', 'Technique', 'Performance', 'Mindset & Practice', 'For Professionals'];
const categoryCounts: Record<string, number> = {};
categoryNames.forEach(cat => {
  categoryCounts[cat] = posts.filter(p => p.data.categories?.includes(cat)).length;
});
---

<Layout
  title="Voice Tips & Insights | TVA Blog"
  description="Practical advice for singers, speakers, and voice enthusiasts. Tips on technique, vocal health, and performance from a 40-year voice coaching veteran."
>
  <!-- Hero Section -->
  <section class="hero">
    <div class="container reveal">
      <span class="hero-eyebrow">Blog</span>
      <h1>Ideas, insights, and practical guidance for your voice</h1>
      <p class="hero-subtitle">Whether you sing, speak, or both — there's something here for you.</p>
    </div>
  </section>

  <SectionDivider variant="wave" topColor="var(--color-navy-deep)" bottomColor="var(--color-off-white)" />

  <!-- Intro Section -->
  <section class="intro-section">
    <div class="container container-narrow reveal">
      <p class="intro-text">I write about the voice because I find it endlessly fascinating — and because I believe everyone deserves access to good information about how their instrument works.</p>
      <p class="intro-text">These posts explore technique, health, performance, and the mindset behind vocal development. Some are deep dives. Some are quick tips. All of them come from four decades of teaching, performing, and learning alongside my students.</p>
      <p class="intro-text">Browse by topic below, or scroll through the latest posts.</p>
    </div>
  </section>

  <!-- Categories Section -->
  <section class="categories-section">
    <div class="container">
      <h2 class="reveal">Explore by Topic</h2>
      <div class="categories-grid reveal-stagger">
        <button class="category-card reveal" data-filter="Vocal Health" aria-label="Filter posts by Vocal Health">
          <h3><svg class="icon-inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M19 14c1.49-1.46 3-3.21 3-5.5A5.5 5.5 0 0 0 16.5 3c-1.76 0-3 .5-4.5 2-1.5-1.5-2.74-2-4.5-2A5.5 5.5 0 0 0 2 8.5c0 2.3 1.5 4.05 3 5.5l7 7Z"/></svg>Vocal Health <span class="category-count">{categoryCounts['Vocal Health']}</span></h3>
          <p>Taking care of your voice so it can take care of you. Warm-ups, recovery, hydration, and what to do when something feels off.</p>
        </button>
        <button class="category-card reveal" data-filter="Technique" aria-label="Filter posts by Technique">
          <h3><svg class="icon-inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><line x1="4" x2="4" y1="21" y2="14"/><line x1="4" x2="4" y1="10" y2="3"/><line x1="12" x2="12" y1="21" y2="12"/><line x1="12" x2="12" y1="8" y2="3"/><line x1="20" x2="20" y1="21" y2="16"/><line x1="20" x2="20" y1="12" y2="3"/><line x1="2" x2="6" y1="14" y2="14"/><line x1="10" x2="14" y1="8" y2="8"/><line x1="18" x2="22" y1="16" y2="16"/></svg>Technique <span class="category-count">{categoryCounts['Technique']}</span></h3>
          <p>The how and why behind breath support, resonance, phonation, and articulation — the physical foundations of good singing and speaking.</p>
        </button>
        <button class="category-card reveal" data-filter="Performance" aria-label="Filter posts by Performance">
          <h3><svg class="icon-inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><polygon points="13 2 3 14 12 14 11 22 21 10 12 10 13 2"/></svg>Performance <span class="category-count">{categoryCounts['Performance']}</span></h3>
          <p>What happens when you step in front of an audience. Stage presence, audition preparation, and connecting with listeners.</p>
        </button>
        <button class="category-card reveal" data-filter="Mindset & Practice" aria-label="Filter posts by Mindset and Practice">
          <h3><svg class="icon-inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M12 5a3 3 0 1 0-5.997.125 4 4 0 0 0-2.526 5.77 4 4 0 0 0 .556 6.588A4 4 0 1 0 12 18Z"/><path d="M12 5a3 3 0 1 1 5.997.125 4 4 0 0 1 2.526 5.77 4 4 0 0 1-.556 6.588A4 4 0 1 1 12 18Z"/><path d="M15 13a4.5 4.5 0 0 1-3-4 4.5 4.5 0 0 1-3 4"/><path d="M17.599 6.5a3 3 0 0 0 .399-1.375"/><path d="M6.003 5.125A3 3 0 0 0 6.401 6.5"/><path d="M3.477 10.896a4 4 0 0 1 .585-.396"/><path d="M19.938 10.5a4 4 0 0 1 .585.396"/><path d="M6 18a4 4 0 0 1-1.967-.516"/><path d="M19.967 17.484A4 4 0 0 1 18 18"/></svg>Mindset &amp; Practice <span class="category-count">{categoryCounts['Mindset & Practice']}</span></h3>
          <p>The mental and emotional side of vocal development. Confidence, consistency, and the long game of getting better.</p>
        </button>
        <button class="category-card reveal" data-filter="For Professionals" aria-label="Filter posts by For Professionals">
          <h3><svg class="icon-inline" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" aria-hidden="true"><path d="M16 20V4a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/><rect width="20" height="14" x="2" y="6" rx="2"/></svg>For Professionals <span class="category-count">{categoryCounts['For Professionals']}</span></h3>
          <p>Guidance for those building a career with their voice — teaching, industry insights, and communication in business contexts.</p>
        </button>
      </div>
    </div>
  </section>

  <!-- Posts Section -->
  <section class="posts-section" id="posts">
    <div class="container">
      <div class="posts-header reveal">
        <h2>All Posts</h2>
        <div class="active-filter" id="active-filter" style="display: none;">
          <span id="filter-label"></span>
          <button id="clear-filter" class="clear-filter" aria-label="Clear filter">&times; Show all</button>
        </div>
      </div>
      <div class="posts-grid reveal-stagger" id="posts-grid">
        {posts.map((post) => (
          <a href={`/blog/${post.slug}`} class="post-card reveal" data-categories={JSON.stringify(post.data.categories || [])}>
            {post.data.image && (
              <div class="post-card-image">
                <img src={post.data.image.url} alt={post.data.image.alt} width="400" height="225" loading="lazy" />
              </div>
            )}
            <div class="post-card-body">
              <div class="post-card-meta">
                {post.data.categories?.slice(0, 2).map(cat => (
                  <span class="post-card-category">{cat}</span>
                ))}
                <time datetime={post.data.pubDate.toISOString()}>
                  {post.data.pubDate.toLocaleDateString('en-US', { year: 'numeric', month: 'short', day: 'numeric' })}
                </time>
              </div>
              <h3>{post.data.title}</h3>
              {post.data.description && (
                <p>{post.data.description}</p>
              )}
              <span class="read-more">Read more &rarr;</span>
            </div>
          </a>
        ))}
      </div>
      <p class="no-results" id="no-results" style="display: none;">No posts found in this category yet. <button id="reset-filter" class="reset-link">Show all posts</button></p>
    </div>
  </section>

  <!-- Category Filter Script -->
  <script>
    document.addEventListener('DOMContentLoaded', () => {
      const categoryCards = document.querySelectorAll('[data-filter]');
      const postCards = document.querySelectorAll('.post-card[data-categories]');
      const activeFilter = document.getElementById('active-filter');
      const filterLabel = document.getElementById('filter-label');
      const clearFilter = document.getElementById('clear-filter');
      const resetFilter = document.getElementById('reset-filter');
      const noResults = document.getElementById('no-results');
      const postsHeader = document.querySelector('.posts-header h2');
      let currentFilter = null;

      function filterPosts(category) {
        if (currentFilter === category) {
          showAll();
          return;
        }
        currentFilter = category;
        let visibleCount = 0;

        postCards.forEach(card => {
          const cats = JSON.parse(card.getAttribute('data-categories') || '[]');
          if (cats.includes(category)) {
            card.style.display = '';
            visibleCount++;
          } else {
            card.style.display = 'none';
          }
        });

        categoryCards.forEach(btn => {
          btn.classList.toggle('active', btn.getAttribute('data-filter') === category);
        });

        if (activeFilter && filterLabel) {
          filterLabel.textContent = category;
          activeFilter.style.display = 'flex';
        }
        if (postsHeader) postsHeader.textContent = category;
        if (noResults) noResults.style.display = visibleCount === 0 ? 'block' : 'none';

        document.getElementById('posts')?.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }

      function showAll() {
        currentFilter = null;
        postCards.forEach(card => card.style.display = '');
        categoryCards.forEach(btn => btn.classList.remove('active'));
        if (activeFilter) activeFilter.style.display = 'none';
        if (postsHeader) postsHeader.textContent = 'All Posts';
        if (noResults) noResults.style.display = 'none';
      }

      categoryCards.forEach(btn => {
        btn.addEventListener('click', () => filterPosts(btn.getAttribute('data-filter')));
      });

      clearFilter?.addEventListener('click', showAll);
      resetFilter?.addEventListener('click', showAll);
    });
  </script>

  <SectionDivider variant="curve" topColor="var(--color-off-white)" bottomColor="var(--color-navy-deep)" />

  <!-- Newsletter Section -->
  <section class="newsletter-section">
    <div class="container container-narrow">
      <h2 class="reveal">Stay in the loop</h2>
      <p class="newsletter-intro">Get notified when new articles are published — plus occasional voice tips and updates.</p>
      <form
        name="blog-newsletter"
        method="POST"
        action="/success"
        data-netlify="true"
        netlify-honeypot="bot-field"
        class="newsletter-form reveal"
      >
        <p class="hidden">
          <label>Don't fill this out if you're human: <input name="bot-field" /></label>
        </p>
        <input type="hidden" name="form-name" value="blog-newsletter" />
        <div class="newsletter-fields">
          <input type="text" name="first-name" placeholder="First name" aria-label="First name" />
          <input type="email" name="email" placeholder="Email address" aria-label="Email address" required />
          <button type="submit" class="btn btn-primary">Subscribe</button>
        </div>
      </form>
    </div>
  </section>

  <SectionDivider variant="wave" topColor="var(--color-navy-deep)" bottomColor="var(--color-white)" />

  <!-- CTA Section -->
  <section class="cta-section">
    <div class="container reveal">
      <h2>Want to go deeper?</h2>
      <p>Reading is a great start. Working together is where real progress happens. If something here sparks a question or a goal, I'd love to hear about it.</p>
      <a href="/contact" class="btn btn-primary">Book a Free Discovery Call</a>
      <p class="cta-secondary">Or reach out anytime: <a href="mailto:ted@tedsvoiceacademy.com">ted@tedsvoiceacademy.com</a></p>
    </div>
  </section>
</Layout>

<style>
  /* Hero Section */
  .hero {
    background:
      url('/images/noise-texture.png') repeat,
      linear-gradient(135deg, var(--color-navy-deep) 0%, var(--color-navy-medium) 100%);
    background-size: 200px 200px, 100% 100%;
    background-blend-mode: soft-light, normal;
    padding: 5rem 0 4rem;
    text-align: center;
  }

  .hero-eyebrow {
    display: block;
    font-size: 1rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.15em;
    color: var(--color-gold-bright);
    margin-bottom: 0.75rem;
  }

  .hero h1 {
    font-family: var(--font-heading);
    font-size: clamp(2.25rem, 5vw + 1rem, 3.5rem);
    font-weight: 700;
    color: var(--color-white);
    margin: 0 0 1rem;
    line-height: 1.2;
  }

  .hero-subtitle {
    font-size: 1.25rem;
    color: var(--color-cream);
    max-width: 600px;
    margin: 0 auto;
  }

  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 1rem 2rem;
    font-size: 1rem;
    font-weight: 600;
    border-radius: 6px;
    text-decoration: none;
    cursor: pointer;
    transition: all 0.2s ease;
    border: none;
    font-family: var(--font-body);
  }

  .btn-primary {
    background: var(--color-gold-bright);
    color: var(--color-navy-deep);
  }

  .btn-primary:hover {
    background: var(--color-gold-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(212, 168, 75, 0.3);
  }

  /* Container Narrow */
  .container-narrow {
    max-width: 800px;
    margin: 0 auto;
  }

  /* Intro Section */
  .intro-section {
    background: var(--color-off-white);
    padding: 4rem 0;
  }

  .intro-text {
    font-size: 1.125rem;
    line-height: 1.8;
    color: var(--color-charcoal);
    margin-bottom: 1rem;
  }

  .intro-text:last-child {
    margin-bottom: 0;
  }

  /* Categories Section */
  .categories-section {
    background: var(--color-white);
    padding: 4rem 0;
  }

  .categories-section h2 {
    font-family: var(--font-heading);
    font-size: clamp(1.75rem, 3vw + 1rem, 2.5rem);
    font-weight: 700;
    color: var(--color-navy-deep);
    text-align: center;
    margin: 0 0 2rem;
  }

  .categories-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .category-card {
    background: var(--color-off-white);
    padding: 1.75rem;
    border-radius: 12px;
    border-left: 4px solid var(--color-gold-bright);
    border-right: none;
    border-top: none;
    border-bottom: none;
    transition: transform 0.2s ease, box-shadow 0.2s ease, background 0.2s ease;
    display: flex;
    flex-direction: column;
    cursor: pointer;
    text-align: left;
    font-family: var(--font-body);
  }

  .category-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.06);
  }

  .category-card.active {
    background: var(--color-navy-deep);
    border-left-color: var(--color-gold-bright);
  }

  .category-card.active h3 {
    color: var(--color-white);
  }

  .category-card.active p {
    color: var(--color-cream);
  }

  .category-card.active .category-count {
    background: var(--color-gold-bright);
    color: var(--color-navy-deep);
  }

  .category-card h3 {
    font-family: var(--font-heading);
    font-size: 1.25rem;
    font-weight: 700;
    color: var(--color-navy-deep);
    margin: 0 0 0.75rem;
    display: flex;
    align-items: center;
    gap: 0.5rem;
  }

  .category-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-body);
    font-size: 0.75rem;
    font-weight: 700;
    min-width: 1.5rem;
    height: 1.5rem;
    padding: 0 0.375rem;
    border-radius: 12px;
    background: rgba(212, 168, 75, 0.15);
    color: var(--color-gold-bright);
  }

  .category-card p {
    color: var(--color-charcoal);
    line-height: 1.6;
    margin: 0;
    font-size: 0.9375rem;
    flex-grow: 1;
  }

  /* Posts Section */
  .posts-section {
    background: var(--color-off-white);
    padding: 4rem 0;
  }

  .posts-header {
    text-align: center;
    margin-bottom: 2rem;
  }

  .posts-header h2 {
    font-family: var(--font-heading);
    font-size: clamp(1.75rem, 3vw + 1rem, 2.5rem);
    font-weight: 700;
    color: var(--color-navy-deep);
    margin: 0 0 0.5rem;
  }

  .active-filter {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.75rem;
    font-size: 0.9375rem;
    color: var(--color-charcoal);
  }

  .active-filter span {
    font-weight: 600;
    color: var(--color-gold-bright);
  }

  .clear-filter {
    background: none;
    border: 1px solid var(--color-gray-light);
    color: var(--color-charcoal);
    font-size: 0.8125rem;
    padding: 0.25rem 0.75rem;
    border-radius: 20px;
    cursor: pointer;
    font-family: var(--font-body);
    transition: all 0.2s ease;
  }

  .clear-filter:hover {
    border-color: var(--color-gold-bright);
    color: var(--color-gold-bright);
  }

  .no-results {
    text-align: center;
    color: var(--color-charcoal);
    font-size: 1.0625rem;
    padding: 2rem 0;
  }

  .reset-link {
    background: none;
    border: none;
    color: var(--color-gold-bright);
    font-size: inherit;
    cursor: pointer;
    text-decoration: underline;
    font-family: var(--font-body);
  }

  .reset-link:hover {
    color: var(--color-gold-hover);
  }

  .posts-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 1.5rem;
  }

  .post-card {
    background: var(--color-white);
    border-radius: 12px;
    overflow: hidden;
    text-decoration: none;
    color: inherit;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
    display: flex;
    flex-direction: column;
  }

  .post-card:hover {
    transform: translateY(-4px);
    box-shadow: var(--shadow-card-hover);
  }

  .post-card-image {
    aspect-ratio: 16 / 9;
    overflow: hidden;
  }

  .post-card-image img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.3s ease;
  }

  .post-card:hover .post-card-image img {
    transform: scale(1.03);
  }

  .post-card-body {
    padding: 1.25rem;
    display: flex;
    flex-direction: column;
    flex-grow: 1;
  }

  .post-card-meta {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: 0.5rem;
    margin-bottom: 0.75rem;
  }

  .post-card-category {
    font-size: 0.6875rem;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.06em;
    color: var(--color-gold-bright);
    background: rgba(212, 168, 75, 0.1);
    padding: 0.15rem 0.5rem;
    border-radius: 3px;
  }

  .post-card-meta time {
    font-size: 0.8125rem;
    color: var(--color-gray-medium);
  }

  .post-card-body h3 {
    font-family: var(--font-heading);
    font-size: 1.125rem;
    font-weight: 700;
    color: var(--color-navy-deep);
    line-height: 1.3;
    margin: 0 0 0.5rem;
  }

  .post-card-body p {
    font-size: 0.875rem;
    line-height: 1.6;
    color: var(--color-charcoal-light);
    margin: 0 0 1rem;
    flex-grow: 1;
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .read-more {
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--color-gold-bright);
    margin-top: auto;
  }

  .post-card:hover .read-more {
    color: var(--color-gold-hover);
  }

  /* Newsletter Section */
  .newsletter-section {
    background:
      url('/images/noise-texture.png') repeat,
      linear-gradient(135deg, var(--color-navy-deep) 0%, var(--color-navy-medium) 100%);
    background-size: 200px 200px, 100% 100%;
    background-blend-mode: soft-light, normal;
    padding: 4rem 0;
    text-align: center;
  }

  .newsletter-section h2 {
    font-family: var(--font-heading);
    font-size: clamp(1.75rem, 3vw + 1rem, 2.5rem);
    font-weight: 700;
    color: var(--color-white);
    margin: 0 0 1rem;
  }

  .newsletter-intro {
    font-size: 1.125rem;
    color: var(--color-cream);
    margin: 0 0 2rem;
  }

  .newsletter-form {
    max-width: 550px;
    margin: 0 auto;
  }

  .newsletter-fields {
    display: flex;
    gap: 0.75rem;
    flex-wrap: wrap;
    justify-content: center;
  }

  .newsletter-fields input[type="text"],
  .newsletter-fields input[type="email"] {
    padding: 0.875rem 1rem;
    font-size: 1rem;
    border: 2px solid rgba(255, 255, 255, 0.2);
    border-radius: 6px;
    background: rgba(255, 255, 255, 0.1);
    color: var(--color-white);
    font-family: var(--font-body);
    flex: 1;
    min-width: 180px;
  }

  .newsletter-fields input::placeholder {
    color: rgba(255, 255, 255, 0.6);
  }

  .newsletter-fields input:focus {
    outline: none;
    border-color: var(--color-gold-bright);
    box-shadow: 0 0 0 3px rgba(212, 168, 75, 0.15);
  }

  .hidden {
    display: none;
  }

  /* CTA Section */
  .cta-section {
    background: var(--color-white);
    padding: 4rem 0;
    text-align: center;
  }

  .cta-section h2 {
    font-family: var(--font-heading);
    font-size: clamp(1.75rem, 3vw + 1rem, 2.5rem);
    font-weight: 700;
    color: var(--color-navy-deep);
    margin: 0 0 1rem;
  }

  .cta-section > .container > p {
    font-size: 1.125rem;
    color: var(--color-charcoal);
    max-width: 600px;
    margin: 0 auto 2rem;
    line-height: 1.7;
  }

  .cta-secondary {
    margin-top: 1.5rem;
    font-size: 0.9375rem;
    color: var(--color-charcoal);
  }

  .cta-secondary a {
    color: var(--color-gold-bright);
    text-decoration: none;
  }

  .cta-secondary a:hover {
    text-decoration: underline;
  }

  /* Mobile Adjustments */
  @media (max-width: 768px) {
    .hero {
      padding: 3.5rem 0 3rem;
    }

    .intro-section,
    .categories-section,
    .posts-section,
    .newsletter-section,
    .cta-section {
      padding: 3rem 0;
    }

    .categories-grid {
      grid-template-columns: repeat(2, 1fr);
    }

    .categories-grid .category-card:last-child {
      grid-column: 1 / -1;
      max-width: 50%;
      margin: 0 auto;
    }

    .posts-grid {
      grid-template-columns: 1fr;
      gap: 1.25rem;
    }

    .newsletter-fields {
      flex-direction: column;
    }

    .newsletter-fields input[type="text"],
    .newsletter-fields input[type="email"] {
      min-width: auto;
    }
  }

  @media (min-width: 769px) and (max-width: 1024px) {
    .posts-grid {
      grid-template-columns: repeat(2, 1fr);
    }
  }

  @media (max-width: 480px) {
    .categories-grid {
      grid-template-columns: 1fr;
    }

    .categories-grid .category-card:last-child {
      max-width: 100%;
    }
  }
</style>
